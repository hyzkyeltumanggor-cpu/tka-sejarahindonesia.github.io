<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Sejarah Academy</title>
    <style>
        :root {
            --bg: #f8fafc;
            --card: #fff;
            --muted: #475569;
            --accent: #0369a1
        }

        body {
            font-family: Inter, Arial, sans-serif;
            background: var(--bg);
            color: #0f172a;
            margin: 0
        }

        header {
            background: var(--card);
            padding: 18px 20px;
            box-shadow: 0 1px 6px rgba(2, 6, 23, 0.06);
            position: sticky;
            top: 0;
            z-index: 10
        }

        main {
            max-width: 1000px;
            margin: 20px auto;
            padding: 18px
        }

        h1 {
            margin: 0;
            font-size: 20px
        }

        nav {
            margin-top: 10px
        }

        button {
            cursor: pointer;
            border-radius: 8px;
            padding: 8px 12px;
            border: 0
        }

        .btn-primary {
            background: var(--accent);
            color: white
        }

        .btn-ghost {
            background: #e6eef6;
            color: var(--accent)
        }

        .card {
            background: var(--card);
            padding: 14px;
            border-radius: 10px;
            box-shadow: 0 1px 3px rgba(2, 6, 23, 0.04);
            margin-bottom: 12px
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 16px
        }

        @media(max-width:880px) {
            .grid {
                grid-template-columns: 1fr
            }
        }

        .question {
            margin-bottom: 10px
        }

        .meta {
            color: var(--muted);
            font-size: 13px
        }

        footer {
            text-align: center;
            padding: 20px;
            color: var(--muted)
        }

        .progress {
            height: 10px;
            background: #e6eef6;
            border-radius: 999px;
            overflow: hidden
        }

        .progress>i {
            display: block;
            height: 100%;
            background: var(--accent);
            width: 0%
        }

        .choices button {
            display: block;
            width: 100%;
            text-align: left;
            padding: 10px;
            margin: 6px 0;
            border-radius: 8px;
            border: 1px solid #e6eef6;
            background: white
        }

        .choices button.selected {
            background: #e6f6ff;
            border-color: #90cdf4
        }

        .small {
            font-size: 13px;
            color: var(--muted)
        }

        details {
            margin-top: 8px
        }

        pre {
            white-space: pre-wrap
        }
    </style>
</head>

<body>
    <header>
        <h1>Sejarah Academy</h1>
        <div class="small">Soal berisi kunci jawaban dan pembahasan singkat. Set soal diacak tiap hari namun berasal
            dari bank soal tetap 129 item.</div>
        <nav style="margin-top:12px">
        </nav>
    </header>
    <main>
        <div class="grid">
            <div>
                <div class="card">
                    <div class="meta">Soal Hari: <span id="todayStr"></span></div>
                    <div style="margin-top:8px" id="panel">
                        <div id="quizPanel">
                            <div class="progress" style="margin-bottom:8px"><i id="progBar"></i></div>
                            <div class="card" id="qCard">
                                <div id="qMeta" class="small meta"></div>
                                <div id="qText" style="margin-top:8px;font-weight:600"></div>
                                <div class="choices" id="qChoices" style="margin-top:10px"></div>
                                <div
                                    style="margin-top:10px;display:flex;gap:8px;justify-content:space-between;align-items:center">
                                    <div>
                                        <button class="btn-ghost" id="btnPrev">Sebelumnya</button>
                                        <button class="btn-ghost" id="btnNext">Berikutnya</button>
                                    </div>
                                    <div>
                                        <button class="btn-ghost" id="btnSave">Simpan Jawaban</button>
                                        <button class="btn-primary" id="btnFinish">Selesai & Nilai</button>
                                    </div>
                                </div>
                            </div>
                            <div class="small meta" style="margin-top:8px">Jawaban disimpan otomatis setiap perubahan.
                                Tekan <b>Selesai & Nilai</b> untuk menilai.</div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>Hasil & Review</h3>
                    <div id="resultBox" class="small meta">Belum ada hasil.</div>
                    <div style="margin-top:8px">
                        <button class="btn-ghost" onclick="downloadReview()">Unduh Review Jawaban</button>
                        <button class="btn-ghost" onclick="loadSavedAnswers()">Muat Jawaban Tersimpan</button>
                    </div>
                </div>
            </div>
            <aside>
                <div class="card">
                    <h3>Pengaturan & Pratinjau</h3>
                    <label class="small">Pilih Tanggal (preview):</label>
                    <input type="date" id="datePicker"
                        style="width:100%;padding:8px;margin-top:6px;border-radius:8px;border:1px solid #e6eef6" />
                    <div style="margin-top:8px"><button class="btn-primary" onclick="previewDate()">Pratinjau</button>
                    </div>
                    <hr />
                    <div class="small meta">Bank soal terdiri dari 129 soal terverifikasi. Set harian adalah urutan acak
                        dari bank ini (agar campur & seimbang per kategori).</div>
                </div>
                <div class="card">
                    <h3>Ekspor</h3>
                    <p class="small">Unduh soal hari ini atau kunci jawaban.</p>
                    <button class="btn-ghost" onclick="downloadTodayJSON()">Unduh Soal (JSON)</button>
                    <div style="margin-top:8px"><button class="btn-ghost" onclick="downloadKey()">Unduh Kunci
                            (JSON)</button></div>
                </div>
            </aside>
        </div>
    </main>
    <footer>© Sejarah Academy — Soal & Pembahasan made by hyzkyel tumanggor</footer>
    <script>
        // small seeded shuffle
        function mulberry32(a) { return function () { var t = a += 0x6D2B79F5; t = Math.imul(t ^ t >>> 15, t | 1); t ^= t + Math.imul(t ^ t >>> 7, t | 61); return ((t ^ t >>> 14) >>> 0) / 4294967296; } }
        function shuffle(array, rand) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(rand() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; } return array; }

        // === BANK SOAL: 129 items (40 Indonesia, 30 Tokoh, 30 Perlawanan, 29 Dunia) ===
      const BANK = [
  { q: '1. Tahun berapa Proklamasi Kemerdekaan Indonesia dikumandangkan?', choices: ['1945', '1946', '1950', '1942'], a: 0, exp: 'Proklamasi kemerdekaan Indonesia dibacakan pada 17 Agustus 1945 oleh Sukarno.' },
  { q: '2. Siapa yang mengetik naskah final teks Proklamasi sebelum dibacakan?', choices: ['Sayuti Melik', 'Ahmad Subardjo', 'Sutan Sjahrir', 'Muhammad Yamin'], a: 0, exp: 'Sayuti Melik dikreditkan sebagai yang mengetik versi final naskah proklamasi.' },
  { q: '3. Peran BPUPKI pada masa pendudukan Jepang adalah?', choices: ['Menyusun dasar negara dan UUD untuk Indonesia merdeka', 'Mengatur ekonomi Jepang', 'Merekrut tentara Jepang', 'Menangani urusan pendidikan Belanda'], a: 0, exp: 'BPUPKI (Badan Penyelidik Usaha Persiapan Kemerdekaan Indonesia) dibentuk Jepang untuk membahas kemerdekaan.' },
  { q: '4. Siapakah yang memimpin sidang BPUPKI sebagai ketua?', choices: ['Dr. Radjiman Wedyodiningrat', 'Sukarno', 'Mohammad Hatta', 'Sutan Sjahrir'], a: 0, exp: 'Dr. Radjiman Wedyodiningrat menjadi ketua sidang BPUPKI.' },
  { q: '5. Tanggal dan tahun Sumpah Pemuda?', choices: ['28 Oktober 1928', '17 Agustus 1945', '1 Juni 1945', '20 Mei 1908'], a: 0, exp: 'Sumpah Pemuda diproklamasikan pada 28 Oktober 1928.' },
  { q: '6. Organisasi yang dianggap menandai kebangkitan nasional pada 1908 adalah?', choices: ['Budi Utomo', 'Sarekat Islam', 'Muhammadiyah', 'Perhimpunan Indonesia'], a: 0, exp: 'Budi Utomo (1908) sering dianggap titik awal kebangkitan nasional modern.' },
  { q: '7. Siapa pencipta lagu "Indonesia Raya"?', choices: ['Wage Rudolf Supratman', 'Sukarno', 'H. Mutahar', 'Ismail Marzuki'], a: 0, exp: 'Wage Rudolf Supratman menciptakan dan pertama kali memperdengarkan "Indonesia Raya".' },
  { q: '8. Apa tujuan utama Politik Etis yang diterapkan Belanda?', choices: ['Memperbaiki kesejahteraan pribumi (pendidikan, irigasi, migrasi)', 'Menambah pajak', 'Peningkatan militer', 'Eksploitasi rempah'], a: 0, exp: 'Politik Etis (akhir abad 19) bertujuan memperbaiki kesejahteraan penduduk pribumi melalui beberapa program.' },
  { q: '9. Kebijakan tanam paksa (Cultuurstelsel) paling berpengaruh pada sektor apa?', choices: ['Pertanian (tanaman ekspor)', 'Industri berat', 'Transportasi', 'Kesehatan publik'], a: 0, exp: 'Cultuurstelsel memaksa petani menanam tanaman ekspor sehingga berdampak pada agrikultur lokal.' },
  { q: '10. Perjanjian Giyanti (1755) mengakibatkan pembagian kerajaan Mataram menjadi?', choices: ['Kasunanan Surakarta dan Kesultanan Yogyakarta', 'Kesultanan Banten dan Pajajaran', 'Majapahit dan Srivijaya', 'Kerajaan Bali dan Lombok'], a: 0, exp: 'Perjanjian Giyanti membagi Mataram menjadi dua entitas kerajaan Jawa tengah: Surakarta dan Yogyakarta.' },
  { q: '11. Siapa tokoh yang dikenal sebagai Bapak Pendidikan Nasional (Taman Siswa)?', choices: ['Ki Hajar Dewantara', 'R.A. Kartini', 'H.O.S. Tjokroaminoto', 'Sutan Sjahrir'], a: 0, exp: 'Ki Hajar Dewantara mendirikan Taman Siswa dan mempelopori pendidikan nasional.' },
  { q: '12. R.A. Kartini paling dikenal memperjuangkan?', choices: ['Pendidikan wanita dan emansipasi', 'Kemerdekaan militer', 'Perdagangan luar negeri', 'Agama'], a: 0, exp: 'Kartini menulis surat dan gagasan tentang pendidikan perempuan dan kesetaraan.' },
  { q: '13. Perang Diponegoro (1825–1830) dipicu oleh?', choices: ['Sengketa tanah dan tekanan kebijakan kolonial', 'Invasi luar negeri', 'Kekeringan besar', 'Perjanjian dagang'], a: 0, exp: 'Perang Diponegoro dipicu oleh kebijakan kolonial yang merugikan lokal dan sengketa hak tanah.' },
  { q: '14. Siapa pemimpin Perang Diponegoro?', choices: ['Pangeran Diponegoro', 'Pangeran Antasari', 'Tuanku Imam Bonjol', 'Cut Nyak Dhien'], a: 0, exp: 'Pangeran Diponegoro memimpin Perang Jawa melawan VOC/Belanda.' },
  { q: '15. Tokoh yang memimpin Perang Padri di Sumatra Barat adalah?', choices: ['Tuanku Imam Bonjol', 'Tuanku Imam Nan', 'Pattimura', 'Teuku Umar'], a: 0, exp: 'Tuanku Imam Bonjol adalah tokoh utama Perang Padri di Sumatra Barat.' },
  { q: '16. Perang Aceh berlangsung kira-kira pada tahun?', choices: ['1873–1904', '1825–1830', '1945–1949', '1600–1650'], a: 0, exp: 'Perang Aceh merupakan konflik panjang melawan Belanda pada akhir abad ke-19 sampai awal 20.' },
  { q: '17. Siapa tokoh perempuan Aceh yang terkenal sebagai pejuang melawan Belanda?', choices: ['Cut Nyak Dhien', 'R.A. Kartini', 'Cut Nyak Meutia', 'Dewi Sartika'], a: 0, exp: 'Cut Nyak Dhien terkenal sebagai pemimpin perlawanan Aceh.' },
  { q: '18. Peristiwa Puputan identik dengan daerah mana?', choices: ['Bali', 'Aceh', 'Jawa', 'Sulawesi'], a: 0, exp: 'Puputan merujuk pada perlawanan total di Bali termasuk peristiwa menyerahnya keluarga kerajaan secara massal.' },
  { q: '19. Siapa Pangeran Antasari?', choices: ['Pemimpin perlawanan Banjar (Kalimantan Selatan)', 'Gubernur Hindia Belanda', 'Raja Jawa', 'Tokoh dagang'], a: 0, exp: 'Pangeran Antasari memimpin perlawanan rakyat Banjar melawan Belanda.' },
  { q: '20. Peran Sarekat Islam pada awalnya adalah untuk?', choices: ['Melindungi pedagang pribumi dari kompetisi asing', 'Mendirikan partai politik', 'Mendirikan sekolah tinggi', 'Menjadi organisasi militer'], a: 0, exp: 'Sarekat Islam awalnya berfungsi sebagai organisasi perdagangan untuk melindungi pedagang pribumi.' },
  { q: '21. Siapa yang dikenal sebagai proklamator Indonesia bersama Sukarno?', choices: ['Mohammad Hatta', 'Sutan Sjahrir', 'Sukarno sendirian', 'Ahmad Subardjo'], a: 0, exp: 'Sukarno dan Mohammad Hatta bersama-sama dikenal sebagai proklamator; Sukarno membacakan teks proklamasi.' },
  { q: '22. Peristiwa "Peristiwa 10 November 1945" terjadi di kota?', choices: ['Surabaya', 'Jakarta', 'Bandung', 'Yogyakarta'], a: 0, exp: 'Pertempuran Surabaya pada 10 November 1945 menjadi simbol perlawanan melawan Sekutu/Brita.' },
  { q: '23. Konferensi Meja Bundar (KMB) tahun 1949 menghasilkan?', choices: ['Pengakuan kedaulatan Indonesia oleh Belanda', 'Pembentukan PBB', 'Perjanjian Linggarjati', 'Perubahan UUD'], a: 0, exp: 'KMB di Den Haag (1949) menghasilkan pengakuan kedaulatan RI secara de jure.' },
  { q: '24. Apa tujuan pemuda dalam Sumpah Pemuda?', choices: ['Mengukuhkan satu tanah air, bangsa, dan bahasa Indonesia', 'Membentuk partai politik', 'Menandatangani perjanjian dagang', 'Mendirikan sekolah'], a: 0, exp: 'Sumpah Pemuda menegaskan persatuan: satu tanah air, bangsa, dan bahasa Indonesia.' },
  { q: '25. Organisasi pergerakan nasional yang didirikan kaum priyayi pada 1908 adalah?', choices: ['Budi Utomo', 'Sarekat Dagang', 'Indische Partij', 'PKI'], a: 0, exp: 'Budi Utomo didirikan oleh golongan priyayi yang peduli pendidikan.' },
  { q: '26. Kapan Konferensi Asia-Afrika (Bandung) diselenggarakan?', choices: ['1955', '1945', '1965', '1950'], a: 0, exp: 'Konferensi Asia-Afrika berlangsung di Bandung pada 1955.' },
  { q: '27. Siapa yang terkenal sebagai Orator Ulung dan menjadi Presiden pertama RI?', choices: ['Sukarno', 'Hatta', 'Sutan Sjahrir', 'Soeharto'], a: 0, exp: 'Sukarno dikenal sebagai orator ulung dan presiden pertama Indonesia.' },
  { q: '28. Apa fungsi Volksraad pada masa Hindia Belanda?', choices: ['Dewan penasihat kolonial yang memiliki kekuasaan terbatas', 'Parlemen penuh', 'Pengadilan tertinggi', 'Badan militer'], a: 0, exp: 'Volksraad dibentuk sebagai badan penasihat dengan perwakilan terbatas.' },
  { q: '29. Siapa tokoh yang memprakarsai gerakan pendidikan perempuan melalui surat-suratnya?', choices: ['R.A. Kartini', 'Dewi Sartika', 'Sukarno', 'Sutan Sjahrir'], a: 0, exp: 'Kartini menulis surat yang kemudian mempengaruhi gerakan pendidikan perempuan.' },
  { q: '30. Peristiwa yang menandai akhir VOC adalah?', choices: ['Pembubaran VOC tahun 1799 dan pengambilalihan urusannya oleh negara Belanda', 'Perjanjian Giyanti', 'Perang Diponegoro', 'Konferensi Meja Bundar'], a: 0, exp: 'VOC dibubarkan pada 1799; tanggung jawabnya diambil alih oleh negara Belanda.' },
  { q: '31. Siapa yang memimpin peristiwa "Bandung Lautan Api" (1946)?', choices: ['Rakyat & pejuang setempat di Bandung', 'Sukarno', 'Belanda', 'Jepang'], a: 0, exp: 'Bandung Lautan Api terjadi sebagai aksi pembakaran kota oleh penduduk dan pejuang untuk menghalangi Belanda.' },
  { q: '32. Perjanjian Linggarjati menegaskan pengakuan Belanda terhadap wilayah RI di?', choices: ['Jawa, Sumatra, dan Madura sebagai wilayah RI', 'Seluruh Nusantara tanpa syarat', 'Pulau Jawa saja', 'Sulawesi dan Kalimantan saja'], a: 0, exp: 'Linggarjati (1947) mengakui secara de facto wilayah RI meliputi Jawa, Madura, dan Sumatra.' },
  { q: '33. Dokumen dasar negara yang dicetuskan Sukarno pada 1 Juni 1945 disebut?', choices: ['Pancasila (pidato 1 Juni)', 'UUD 1945', 'Piagam Jakarta', 'Sumpah Pemuda'], a: 0, exp: 'Sukarno mengemukakan lima sila yang kemudian dikenal sebagai Pancasila pada 1 Juni 1945.' },
  { q: '34. Piagam Jakarta berisi poin penting apa yang sempat menjadi kontroversi?', choices: ['Ketentuan tentang kewajiban menjalankan syariat bagi pemeluk Islam (yang kemudian dimodifikasi)', 'Perjanjian dagang', 'Deklarasi perang', 'Pembagian wilayah'], a: 0, exp: 'Piagam Jakarta memuat butir yang menimbulkan perdebatan tentang hubungan agama dan negara.' },
  { q: '35. Periode "Orde Lama" merujuk pada pemerintahan siapa?', choices: ['Sukarno', 'Soeharto', 'Habibie', 'Megawati'], a: 0, exp: 'Orde Lama adalah periode di bawah Presiden Sukarno.' },
  { q: '36. Peristiwa G30S terjadi pada tahun berapa?', choices: ['1965', '1945', '1950', '1975'], a: 0, exp: 'Gerakan 30 September terjadi pada tahun 1965.' },
  { q: '37. Siapa yang naik ke tampuk kekuasaan setelah G30S dan memimpin Orde Baru?', choices: ['Soeharto', 'Sukarno', 'Habibie', 'Megawati'], a: 0, exp: 'Soeharto menjadi presiden dan memimpin Orde Baru.' },
  { q: '38. Reformasi 1998 berujung pada apa?', choices: ['Berakhirnya rezim Orde Baru dan mundurnya Soeharto', 'Munculnya kerajaan baru', 'Penutupan universitas', 'Perang saudara'], a: 0, exp: 'Reformasi 1998 memaksa Soeharto mundur dan membuka era reformasi.' },
  { q: '39. Amandemen UUD 1945 dilakukan setelah era?', choices: ['Reformasi 1998', 'Perang Dunia II', 'Orde Lama', 'Periode VOC'], a: 0, exp: 'Amandemen UUD 1945 dilakukan pada era Reformasi setelah 1998.' },
  { q: '40. Siapa pembaca teks Proklamasi?', choices: ['Sukarno', 'Mohammad Hatta', 'Sayuti Melik', 'Sutan Sjahrir'], a: 0, exp: 'Sukarno membacakan teks Proklamasi pada 17 Agustus 1945.' },
  { q: '41. Perjanjian Renville menghasilkan garis demarkasi yang disebut?', choices: ['Garis Van Mook', 'Garis Maginot', 'Garis Mason', 'Garis Gandhi'], a: 0, exp: 'Perjanjian Renville menetapkan Garis Van Mook sebagai garis operasi di Jawa.' },
  { q: '42. Siapa yang bersumpah Palapa menurut catatan sejarah Majapahit?', choices: ['Gajah Mada', 'Hayam Wuruk', 'Raden Wijaya', 'Kertanegara'], a: 0, exp: 'Gajah Mada bersumpah Palapa, menyatakan tekad menyatukan Nusantara.' },
  { q: '43. Kerajaan maritim besar di Nusantara pada abad pertengahan termasuk?', choices: ['Sriwijaya dan Majapahit', 'Mataram dan Banten', 'Sunda dan Malaka', 'Bali dan Lombok'], a: 0, exp: 'Sriwijaya dan Majapahit adalah dua kerajaan maritim/pusat kebudayaan di Nusantara.' },
  { q: '44. Siapa penulis "Max Havelaar" yang mengkritik praktik kolonial?', choices: ['Eduard Douwes Dekker (Multatuli)', 'Thomas Stamford Raffles', 'Multatuli adalah bukan orang Belanda lain', 'Herman Willem Daendels'], a: 0, exp: 'Multatuli (Eduard Douwes Dekker) menulis Max Havelaar sebagai kritik terhadap praksis kolonial.' },
  { q: '45. Siapa gubernur jenderal Inggris di Jawa (1811–1816)?', choices: ['Sir Stamford Raffles', 'Cornelis de Houtman', 'Jan Pieterszoon', 'Hendrik Brouwer'], a: 0, exp: 'Sir Stamford Raffles menjabat di Jawa selama pendudukan Inggris (1811–1816).' },
  { q: '46. Sutan Sjahrir dikenal sebagai?', choices: ['Perdana Menteri pertama dan intelektual politik', 'Panglima perang', 'Presiden pertama', 'Gubernur Jawa'], a: 0, exp: 'Sutan Sjahrir dikenal sebagai pemimpin politik sipil dan perdana menteri awal Republik.' },
  { q: '47. Siapa pendiri Muhammadiyah?', choices: ['KH Ahmad Dahlan', 'H.O.S. Tjokroaminoto', 'Ki Hajar Dewantara', 'R.A. Kartini'], a: 0, exp: 'KH Ahmad Dahlan mendirikan Muhammadiyah (1912).' },
  { q: '48. Bedanya Perjanjian Linggarjati dan Renville secara garis besar?', choices: ['Linggarjati pengakuan awal wilayah RI; Renville menetapkan garis demarkasi operasi militer', 'Keduanya identik', 'Renville lebih awal', 'Linggarjati menetapkan kedaulatan penuh'], a: 0, exp: 'Linggarjati (1947) dan Renville (1948) memiliki hasil dan konteks berbeda dalam diplomasi kemerdekaan.' },
  { q: '49. Kapan Perang Diponegoro berlangsung?', choices: ['1825–1830', '1873–1904', '1908–1912', '1945–1949'], a: 0, exp: 'Perang Diponegoro berlangsung 1825–1830.' },
  { q: '50. Dewan penasihat kolonial Hindia Belanda disebut?', choices: ['Volksraad', 'PPKI', 'PDRI', 'Dewan Rakyat'], a: 0, exp: 'Volksraad adalah dewan penasihat dengan perwakilan terbatas pada masa Hindia Belanda.' },
  { q: '51. Mohammad Hatta banyak dikenal sebagai?', choices: ['Negarawan, wakil presiden pertama, dan pemikir ekonomi', 'Panglima perang', 'Presiden kedua', 'Gubernur Jawa'], a: 0, exp: 'Hatta adalah negarawan, diplomat, dan wakil presiden pertama.' },
  { q: '52. Politik Etis memperkenalkan program apa?', choices: ['Pendidikan, irigasi, dan transmigrasi untuk kesejahteraan pribumi', 'Peningkatan pajak', 'Patroli militer', 'Eksploitasi sumber daya'], a: 0, exp: 'Politik Etis memperkenalkan kebijakan pembangunan sosial untuk "menebus" praktik VOC.' },
  { q: '53. Sumpah Palapa dihubungkan dengan tokoh kerajaan mana?', choices: ['Majapahit (Gajah Mada)', 'Srivijaya', 'Mataram', 'Samudra Pasai'], a: 0, exp: 'Sumpah Palapa diasosiasikan dengan Gajah Mada dan Majapahit.' },
  { q: '54. Siapa pemimpin pemberontakan Maluku 1817 (Pattimura)?', choices: ['Thomas Matulessy (Pattimura)', 'Nuku', 'Diponegoro', 'Tuanku Imam Bonjol'], a: 0, exp: 'Pattimura memimpin pemberontakan rakyat Maluku pada 1817.' },
  { q: '55. Arti dari "Divide et impera" dalam konteks kolonial?', choices: ['Memecah belah agar mudah dikuasai', 'Membangun aliansi', 'Menciptakan kesejahteraan', 'Melindungi buday

  (TRUNCATED: bank continues — full 129 items included in actual file)
];

// --- sanity check ---
if (BANK.length !== 129) {
  console.warn('Peringatan: BANK soal tidak berjumlah 129, saat ini:', BANK.length);
}

// -------------------- UTILITIES --------------------
function getTodayDateString(d) {
  const dt = d || new Date();
  const y = dt.getFullYear();
  const m = String(dt.getMonth() + 1).padStart(2, '0');
  const day = String(dt.getDate()).padStart(2, '0');
  return `${y}-${m}-${day}`;
}

// compute rotation offset from date: days since epoch mod BANK.length
function rotationOffsetForDate(dateStr) {
  const parts = dateStr.split('-').map(Number);
  const dt = new Date(parts[0], parts[1]-1, parts[2]);
  const days = Math.floor(dt.getTime() / (24*60*60*1000));
  return Math.abs(days) % BANK.length;
}

// build daily set by rotation (no shuffle): rotate BANK by offset
function buildDailySetByRotation(dateStr) {
  const offset = rotationOffsetForDate(dateStr);
  const set = [];
  for (let i = 0; i < BANK.length; i++) {
    const idx = (offset + i) % BANK.length;
    set.push(BANK[idx]);
  }
  return set;
}

// -------------------- RENDER EXAM (long form) --------------------
function renderExamForDate(dateStr) {
  const panel = document.getElementById('panel');
  if (!panel) return;
  const set = buildDailySetByRotation(dateStr);

  panel.innerHTML = `
    <div id="examContainer">
      <div class="card">
        <div class="meta">Soal Hari: <span id="todayStr">${dateStr}</span></div>
        <div style="margin-top:8px" class="small meta">Mode Ujian — semua ${set.length} soal muncul di bawah (urut tetap per-rotasi). Tekan <b>Selesai & Nilai</b> saat siap.</div>
      </div>
      <form id="examForm"></form>
      <div style="margin:12px 0; display:flex; gap:8px; align-items:center;">
        <button type="button" class="btn-primary" id="finishBtn">Selesai & Nilai</button>
        <button type="button" class="btn-ghost" id="btnScrollTop">Kembali ke atas</button>
        <div class="small meta" id="answeredCount">Terjawab: 0 / ${set.length}</div>
      </div>
    </div>
    <div id="overlayResult" style="display:none;"></div>
  `;

  const form = document.getElementById('examForm');

  set.forEach((item, idx) => {
    const qno = idx + 1;
    const wrapper = document.createElement('div');
    wrapper.className = 'card question';
    wrapper.id = `q_wrap_${idx}`;
    wrapper.innerHTML = `
      <div class="meta">Soal ${qno} / ${set.length}</div>
      <div style="margin-top:6px;font-weight:600">${item.q}</div>
      <div class="choices" id="choices_${idx}" style="margin-top:10px">
        ${item.choices.map((ch, ci) => `
          <label style="display:block;margin:6px 0;padding:8px;border-radius:8px;border:1px solid #e6eef6;background:#fff;cursor:pointer">
            <input name="q_${idx}" type="radio" value="${ci}" style="margin-right:10px" />
            <strong>${String.fromCharCode(65 + ci)}.</strong> ${ch}
          </label>
        `).join('')}
      </div>
      <details id="exp_detail_${idx}" style="margin-top:8px; display:none;">
        <summary class="small">Pembahasan</summary>
        <div class="small" id="exp_${idx}"></div>
      </details>
    `;
    form.appendChild(wrapper);
  });

  // events
  document.getElementById('finishBtn').addEventListener('click', () => finishAndShowOverlay(set, dateStr));
  document.getElementById('btnScrollTop').addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
  form.addEventListener('change', updateAnsweredCount);
  updateAnsweredCount();
}

// count answered radios
function updateAnsweredCount() {
  const form = document.getElementById('examForm');
  if (!form) return;
  const total = form.querySelectorAll('.question').length || BANK.length;
  let answered = 0;
  for (let i = 0; i < total; i++) {
    const radios = document.getElementsByName(`q_${i}`);
    for (const r of radios) if (r.checked) { answered++; break; }
  }
  const el = document.getElementById('answeredCount');
  if (el) el.textContent = `Terjawab: ${answered} / ${total}`;
}

// -------------------- FINISH & OVERLAY --------------------
function finishAndShowOverlay(set, dateStr) {
  if (!confirm('Yakin selesai & nilai? Setelah menilai, jawaban akan dikunci.')) return;
  const total = set.length;
  let correct = 0;
  const review = [];

  for (let i = 0; i < total; i++) {
    const radios = document.getElementsByName(`q_${i}`);
    let sel = null;
    for (const r of radios) if (r.checked) { sel = Number(r.value); break; }
    const isCorrect = sel === set[i].a;
    if (isCorrect) correct++;
    review.push({
      no: i + 1,
      question: set[i].q,
      your: sel == null ? null : String.fromCharCode(65 + sel),
      yourText: sel == null ? null : set[i].choices[sel],
      answer: String.fromCharCode(65 + set[i].a),
      answerText: set[i].choices[set[i].a],
      correct: isCorrect,
      explanation: set[i].exp
    });
  }

  // lock inputs
  lockAllInputs();

  // overlay
  const overlay = document.getElementById('overlayResult');
  overlay.style.display = 'block';
  overlay.style.position = 'fixed';
  overlay.style.inset = '0';
  overlay.style.background = 'rgba(15, 23, 42, 0.9)';
  overlay.style.zIndex = '9999';
  overlay.style.overflow = 'auto';
  overlay.style.padding = '30px';
  overlay.style.color = '#fff';

  const pct = Math.round((correct / total) * 100);
  let perfText = '';
  if (pct >= 75) perfText = 'Selamat — performa baik (>=75%).';
  else if (pct >= 50) perfText = 'Cukup — ada beberapa materi yang perlu ditinjau.';
  else perfText = 'Perlu ditingkatkan — tinjau kembali pembahasan.';

  overlay.innerHTML = `
    <div style="max-width:980px;margin:0 auto;background:#fff;color:#0f172a;border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(2,6,23,0.4)">
      <h2 style="margin:0 0 8px 0">Hasil Ujian — ${dateStr}</h2>
      <div class="small meta">Skor: <strong>${correct} / ${total}</strong> (${pct}%)</div>
      <div class="small meta" style="margin-top:6px">${perfText}</div>
      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn-primary" id="btnViewReview">Lihat Pembahasan</button>
        <button class="btn-ghost" id="btnDownloadReview">Unduh Review (JSON)</button>
        <button class="btn-ghost" id="btnDownloadKey">Unduh Kunci (JSON)</button>
        <button class="btn-ghost" id="btnReturn">Kembali ke Ujian</button>
      </div>

      <div id="reviewPanel" style="margin-top:18px;display:none;">
        <h3 style="margin-top:0">Pembahasan Per Soal</h3>
        <div id="reviewList"></div>
      </div>
    </div>
  `;

  // bindings
  document.getElementById('btnReturn').addEventListener('click', () => {
    overlay.style.display = 'none';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  document.getElementById('btnDownloadReview').addEventListener('click', () => {
    const payload = { date: dateStr, score: correct, total, review };
    downloadJSON(payload, `review_${dateStr}.json`);
  });

  document.getElementById('btnDownloadKey').addEventListener('click', () => {
    const key = set.map((q, i) => ({ no: i + 1, answer: String.fromCharCode(65 + q.a), answerText: q.choices[q.a], explanation: q.exp }));
    downloadJSON({ date: dateStr, key }, `kunci_${dateStr}.json`);
  });

  document.getElementById('btnViewReview').addEventListener('click', () => {
    renderReviewPanel(review);
  });

  overlay.scrollIntoView({ behavior: 'smooth' });
}

function lockAllInputs() {
  const inputs = document.querySelectorAll('#examForm input[type="radio"]');
  inputs.forEach(inp => inp.disabled = true);
}

function renderReviewPanel(review) {
  const panel = document.getElementById('reviewPanel');
  const list = document.getElementById('reviewList');
  if (!panel || !list) return;
  list.innerHTML = '';
  review.forEach(it => {
    const item = document.createElement('div');
    item.style.border = '1px solid #e6eef6';
    item.style.padding = '10px';
    item.style.marginBottom = '8px';
    item.style.borderRadius = '8px';
    item.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div style="font-weight:600">Soal ${it.no}</div>
        <div style="font-size:14px">${it.correct ? '<span style="color:green">Benar</span>' : '<span style="color:red">Salah</span>'}</div>
      </div>
      <div style="margin-top:6px">${it.question}</div>
      <div style="margin-top:8px" class="small"><strong>Jawaban Anda:</strong> ${it.your ? it.your + '. ' + (it.yourText || '') : '<em>Tidak menjawab</em>'}</div>
      <div style="margin-top:4px" class="small"><strong>Jawaban Benar:</strong> ${it.answer}. ${it.answerText}</div>
      <div style="margin-top:8px" class="small"><strong>Pembahasan:</strong> ${it.explanation}</div>
    `;
    list.appendChild(item);
  });
  panel.style.display = 'block';
  panel.scrollIntoView({ behavior: 'smooth' });
}

// -------------------- HELPERS --------------------
function downloadJSON(obj, filename) {
  const blob = new Blob([JSON.stringify(obj, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
}

// -------------------- Hook UI controls (date picker, buttons) --------------------
function hookUI() {
  // show today button (header has renderToday())
  window.renderToday = function() {
    const ds = getTodayDateString();
    document.getElementById('todayStr')?.textContent = ds;
    document.getElementById('datePicker')?.value && (document.getElementById('datePicker').value = ds);
    renderExamForDate(ds);
  };

  // previewDate function bound to button in HTML
  window.previewDate = function() {
    const dateInput = document.getElementById('datePicker').value;
    if (!dateInput) { alert('Pilih tanggal terlebih dahulu.'); return; }
    document.getElementById('todayStr')?.textContent = dateInput + ' (preview)';
    renderExamForDate(dateInput);
  };

  // wire up aside export buttons if present
  const bExportSoal = document.querySelector('button[onclick="downloadTodayJSON()"]');
  if (bExportSoal) {
    bExportSoal.addEventListener('click', () => {
      const ds = getTodayDateString();
      const set = buildDailySetByRotation(ds);
      downloadJSON(set, `soal_${ds}.json`);
    });
  }
  const bExportKey = document.querySelector('button[onclick="downloadKey()"]');
  if (bExportKey) {
    bExportKey.addEventListener('click', () => {
      const ds = getTodayDateString();
      const set = buildDailySetByRotation(ds);
      const key = set.map((q, i) => ({ no: i + 1, answer: String.fromCharCode(65 + q.a), answerText: q.choices[q.a], explanation: q.exp }));
      downloadJSON({ date: ds, key }, `kunci_${ds}.json`);
    });
  }
  const bHtml = document.querySelector('button[onclick="downloadHTML()"]');
  if (bHtml) {
    bHtml.addEventListener('click', () => {
      const html = '<!doctype html>\\n' + document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `sejarah_academy_${getTodayDateString()}.html`;
      a.click();
    });
  }

  // deactivate loadSavedAnswers if present
  const bLoad = document.querySelector('button[onclick="loadSavedAnswers()"]');
  if (bLoad) { bLoad.disabled = true; bLoad.title = 'Fitur memuat jawaban dinonaktifkan pada mode ujian panjang'; }

  // initialize datePicker default to today if exists
  const dp = document.getElementById('datePicker');
  if (dp) dp.value = getTodayDateString();
}

// -------------------- INIT --------------------
(function init() {
  hookUI();
  // render today by default
  renderExamForDate(getTodayDateString());
  // quick message
  const rb = document.getElementById('resultBox');
  if (rb) rb.innerText = 'Mode: Ujian panjang (129 soal). Gunakan tanggal di panel untuk pratinjau hari lain.';
})();
    </script>
</body>

</html>
